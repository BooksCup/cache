### 页面静态化架构的思路
#### 1.设计原则和步骤
目的是为了解决并减轻网站压力，但也会带来一系列问题，包括增加了开发和维护上的复杂程度，运用不好，反而适得其反，
所以在开始之前，需要进行考察，确定是否需要静态化，并指定合适的静态化方式。
##### 1.1 考察读写比
读写比，也就是读写负荷比，是是否值得静态化的最终考虑，因为写入压力明显大于读取压力，如果写入太频繁，或者每次写入消耗的资源太多，就不适合静态化。
##### 1.2 确定页面呈现的内容是否适合静态化
设计的时候要详细考虑每个原形页面，找到页面上的展示信息，和他的更新方式，更新时机，更新频率。
以CSDN为例
帖子内容和回复内容在发帖时更新,发帖后用户可以修改其内容,更新频率高  
用户信息,用户修改个人信息时可能会发生更改,用户等级增加时也可能发生更改,比如加星,更新频率低  
回复数将每次回复后都要更改,更新频率高  
设计时要注意细节,如上图中圈出来的部分,这些部分是怎么修改的,频率有多大,一个都不能放过  
##### 1.3 确定生成方式
一般来说，每次更改都重新生成页面是不可取的，就上面例子而言，需要的数据量是巨大的，任何修改，都需要重新取出数据进行生成是不能允许的。  
除非你的页面基本不用更新，或者更新开销极小才能采用整体更新的方式，不然就需要找到合适的更新页面局部区域的方法:    
一般有如下两种:    
###### 1.3.1 正则修改:
比如,如果帖子中的回复数,html代码是这样  
```html
<label>回复数<var id="replyCount">34</var></label>  
```
我们可以通过用下面正则来查找并替换计数  
```
(?<=id="replyCount">)\d{1,}  
```
###### 1.3.2 页面区域分块
把页面分成很多小块,在显示时组装起来,比如DotText就采用这个方法  
某些部分是一个独立的文件,某些部分是脚本动态加载,这些部分在最终显示的时候组合起来,最终构成了一篇Blog,具体的组合方法也有多种,可以使用Include,也可以自己来实现.DotText就自己实现了一套加载机制  
以上两种方法并不孤立，可以根据需要，配合使用  
#### 2.坑
##### 2.1 对测试要求很高
因为一旦上线后,某个页面发现问题,即使是文字的修改,也需要重新生成许多页面,所以测试人员必须非常仔细,测试周期也需要延长
##### 2.2 开发人员需要掌握模板语言
需要掌握一种模板预言,无论是Xslt还是自己开发的模板语言,都需要花一定的时间掌握  
##### 2.3 需要给第一次生成腾出足够时间
如果不是新系统,那么数据迁移和生成的过程就比较痛苦,由于页面众多,第一次生成的过程可能需要以天来计算,在制定上线方案是就需要考虑到这个方面
##### 2.4 NGINX
Nginx作为前端的跳转,根据其他网站的经验,应该可以达到2-3万并发连接,但是使用之后,常常有卡壳的情况发生,具体症状为在浏览器中访问页面时,连接超时,或者一直不响应,此时Nginx连接数并不高
#### 3.总结
大型网站页面太多，改个模板渲染一坤，此方案不可取